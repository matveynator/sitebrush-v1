<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
[[if isset($Title)]]
 <title>[[$Title]]</title>
[[/if]]
 <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
 <script src='/js/jquery-1.6.1.min.js'></script>
 <script src='http://uranruda.ru:1000/socket.io/socket.io.js'></script>
 <script>
      var socket = io.connect('http://' + document.domain + ':1000');

      $(function () {
        sendMessage = function () {
          if($('#message').val().length)
           socket.emit('user message', {'nickname': '[[$Nickname]]', 'from': [[$From]], 'to': [[$To]], 'room': '[[$Room]]', 'text': $('#message').val(), 'domain': document.domain});
          clear();
          return false;
        };

        function clear () {
          for(var i in CKEDITOR.instances) {
            CKEDITOR.instances[i].setData('');
            CKEDITOR.instances[i].focus();
          }
        };
      });

 </script>
 </head>
<body>
<script src="/js/editor/ckeditor.js" charset="utf-8" language="javascript" type="text/javascript"></script>
<script charset="utf-8" language="javascript" type="text/javascript">
CKEDITOR.on('instanceReady', function( evt ) {
 var editor = evt.editor;
 editor.execCommand('maximize');
});
</script>
<form method="POST" name="Blog" id="Blog" action="javascript:sendMessage();void(0);">
<input type='hidden' id='To' name='To' value='[[$To]]'>
<textarea cols="50" id="message" name="Message" rows="10">
[[$PageText]]
</textarea>
<script type="text/javascript">
CKEDITOR.replace( 'message', 
{
language: 'ru_RU',
uiColor: '#a9a9a9',
fullPage: false,
width: '100%',
height: '100%',
startupFocus : true,
removePlugins: 'elementspath',
toolbar_Full:
[
    ['Smiley']
],
keystrokes:
[
    [ CKEDITOR.CTRL + 83 /*S*/, 'save' ],
    [ CKEDITOR.CTRL + 13, 'save' ],
    [ 13, 'save']
]
});
</script>
</form>
</body>
</html>
